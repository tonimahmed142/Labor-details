<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Baki Chart</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #fff;
    margin: 0;
    padding: 20px;
    text-align: center;
  }
  h2 {
    margin-bottom: 10px;
  }
  canvas {
    max-width: 800px;
    margin: auto;
  }
</style>
</head>
<body>
<h2>ðŸ’° Total Baki Overview</h2>
<canvas id="bakiChart"></canvas>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const ctx = document.getElementById('bakiChart').getContext('2d');

  let chart; // global variable for our chart instance
  let lastData = "";

  function loadChart() {
    const storedData = JSON.parse(localStorage.getItem('labourData')) || [];

    if (storedData.length === 0) {
      return;
    }

    const names = storedData.map(item => item.name || "Unknown");
    const bakiValues = storedData.map(item => parseFloat(item.total) || 0);

    const colors = bakiValues.map(v => v >= 0 ? 'rgba(0, 200, 0, 0.7)' : 'rgba(255, 0, 0, 0.7)');

    // If chart exists, update it
    if (chart) {
      chart.data.labels = names;
      chart.data.datasets[0].data = bakiValues;
      chart.data.datasets[0].backgroundColor = colors;
      chart.update();
    } else {
      // Create new chart if doesn't exist
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: names,
          datasets: [{
            label: 'Total Baki (à§³)',
            data: bakiValues,
            backgroundColor: colors,
            borderColor: '#000',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }
  }

  // Load chart initially
  loadChart();

  // Watch for localStorage updates
  setInterval(() => {
    const newData = localStorage.getItem('labourData');
    if (newData !== lastData) {
      lastData = newData;
      loadChart();
    }
  }, 2000); // check every 2 seconds
});
</script>
</body>
</html>
